{% extends 'base.html' %}

{% block head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
{% endblock %}

{% block title %}Создать новое блюдо{% endblock %}

{% load bootstrap %}

{% block body %}
<!--modal-->
    <div class="modal fade" id="addIngredientModal" tabindex="-1" aria-labelledby="addIngredientModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addIngredientModalLabel">Добавьте ингредиент</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
          </div>
          <form>
            <div class="modal-body">
                <select class="form-select w-50 form-control" aria-label="Ингредиент" style="" id="selectIngredient">
                  <option selected>-----------------</option>
<!--                  <option value="1">Яйцо</option>-->
<!--                  <option value="2">Мука</option>-->
<!--                  <option value="3">Сахар</option>-->
                </select>
                <input type="text" class="form-control" placeholder="количество" aria-label="количество" id="ingredientAmount">
                <select class="form-select form-control" aria-label="измерение" id="selectIngredientDimension">
                  <option selected value="1">миллилитры</option>
                  <option value="2">литры</option>
                </select>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary"  id="btnAdd">Добавить</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
          </div>
          </form>
        </div>
      </div>
    </div>
  <!--end modal-->
{% endblock %}

{% block content %}

  <form method="post">
    {% csrf_token %}

      <div class="mb-3">
        <label for="dishName" class="form-label">Наименование блюда</label>
        <input type="text" class="form-control" id="dishName" >
      </div>
      <div class="mb-3">
        <label for="dishDescr" class="form-label">Описание</label>
        <textarea class="form-control" id="dishDescr" rows="5"></textarea>
      </div>

      <div class="input-group mb-3">
      <span class="input-group-text" id="basic-addon1">ингредиенты</span>
      <button type="button" class="btn btn-outline-secondary"  data-bs-toggle="modal" data-bs-target="#addIngredientModal">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"></path>
          </svg>
      </button>
      </div>
      <div class="mb-3" id="ingredientsList">
        <div class="d-none" id="ingredientItem-0">
          <div class="input-group mb-3">
            <input type="text" class="form-control" id="ingredientName-0">
            <input type="text" class="form-control" id="ingredientAmount-0">
            <input type="text" class="form-control" id="ingredientDimension-0">
          </div>
        </div>
      </div>
    <button type="submit" class="btn btn-success">Сохранить</button>
  </form>

<script>
  const ingredientModal = document.getElementById('addIngredientModal');
  const modal = new bootstrap.Modal(ingredientModal);
  let ingredientId = 0;
  let modalIsShown = 0;
  let ingredientsJson = [];
  let selectIngredientName = document.getElementById('selectIngredient');

  selectIngredientName.addEventListener('change', function(e) {
    alert('1');
  });

  ingredientModal.addEventListener('show.bs.modal', function(e) {
      if (modalIsShown == 1) {return};
      ingredientsJson = [
        {
          'name': 'яйцо',
          'id': '1',
          'dimensions': [{'name': 'шт', 'value': 'piece', 'id': 1}]
        },
        {
          'name': 'мука',
          'id': 2,
           'dimensions': [
                            {'name': 'грамм', 'value': 'g', 'id': 2},
                            {'name': 'килограмм', 'value': 'kg', 'id': 3}
                          ]
        },
        {
          'name': 'сахар',
          'id': 3,
          'dimensions': [
                            {'name': 'грамм', 'value': 'g', 'id': 2},
                            {'name': 'килограмм', 'value': 'kg', 'id': 3}
                          ]
        }
      ];
     // let selectIngredientName = document.getElementById('selectIngredient');
     for (let i = 0; i < ingredientsJson.length; i++){
        let option = document.createElement("option");
        option.text = ingredientsJson[i]['name'];
        option.value = ingredientsJson[i]['value'];
        selectIngredientName.add(option);
     };
    modalIsShown = 1;
  });

  document.getElementById("btnAdd").addEventListener("click", function () {
    let ingredientName = document.getElementById('selectIngredient');
    let ingredientAmount = document.getElementById('ingredientAmount');
    let ingredientDimension = document.getElementById('selectIngredientDimension');
    // close modal
    modal.hide();
    //increment id for ingredient controls
    ingredientId = ingredientId + 1;
    // add new ingredient to the ingredient list
    let ingredientsList = document.getElementById('ingredientsList');
    let ingredientItem = ingredientsList.querySelector('#ingredientItem-0');
    let newIngredientItem = ingredientItem.cloneNode(true);
    newIngredientItem.id = `ingredientItem-${ingredientId}`;
    newIngredientItem.setAttribute('class', 'visible');
    // modify ingredientName input
    let newIngredientName = newIngredientItem.querySelector('#ingredientName-0');
    newIngredientName.value = ingredientName.selectedOptions[0].label;
    newIngredientName.id = `ingredientName-${ingredientId}` ;
    // modify ingredientAmount input
    let newIngredientAmount = newIngredientItem.querySelector('#ingredientAmount-0');
    newIngredientAmount.value = ingredientAmount.value;
    newIngredientAmount.id = `ingredientAmount-${ingredientId}`;
    // modify ingredientDimension input
    let newIngredientDimension = newIngredientItem.querySelector('#ingredientDimension-0');
    newIngredientDimension.value = ingredientDimension.selectedOptions[0].label;
    newIngredientDimension.id = `ingredientDimension-${ingredientId}`;

    ingredientsList.appendChild(newIngredientItem);
  });

</script>
{% endblock %}